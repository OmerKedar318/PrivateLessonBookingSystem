{% extends "base.html" %}
{% block title %}Weekly Schedule{% endblock %}

{% block content %}
<div class="container">
    <h2>Available Sessions</h2>

    <div class="search-form">
        <input
            type="text"
            id="search"
            placeholder="Search by subject..."
            value="{{ query }}"
        >
    </div>

    {% if not query %}
        <p>Search for a subject to see available sessions.</p>
    {% elif not sessions %}
        <p>No sessions found.</p>
    {% endif %}

    <table class="schedule-grid">
        <thead>
            <tr>
                <th>Hour</th>
                {% for day in days %}
                    <th>{{ day_names[day] }}</th>
                {% endfor %}
            </tr>
        </thead>

        <tbody id="sessions-body">
            {% include "_sessions_table.html" %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", () => {
    const search = document.getElementById("search");
    const tbody = document.getElementById("sessions-body");

    search.addEventListener("input", () => {
        fetch(`/sessions?q=${encodeURIComponent(search.value)}`, {
            headers: { "X-Requested-With": "XMLHttpRequest" }
        })
        .then(res => res.text())
        .then(html => {
            tbody.innerHTML = html;
        });
    });
});
</script>
{% endblock %}